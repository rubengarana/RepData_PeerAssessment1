---
title: "PA1_template"
author: "Rubén González Arana"
date: "21/12/2020"
output: html_document
---

## Loading and preprocessing the data

The steps to load and transform the data are shown:

```{r Load_and_Transform,echo=TRUE}
options(scipen = 999)
library(ggplot2)
data1 <- unzip(list.files(pattern = ".zip"))
data1 <- read.csv(data1)
```

## What is mean total number of steps taken per day?

total steps per day

```{r Total Steps,echo=TRUE}
T_step <- sapply(split(data1,data1$date),function(x){sum(x$steps,na.rm = T)})
T_step
```
Histogram of the total number of steps taken each day

```{r Histogram}
hist(T_step,xlab = "Total Steps",main = "Histogram of Steps",col="blue")
abline(v=median(T_step),col="red",lwd=4)
abline(v=mean(T_step),col="green",lwd=4)
```

The median of the total steps per day in red is `r round(median(T_step),2)`, and the mean of the total steps per day in green is `r round(mean(T_step),2)`.

## What is the average daily activity pattern?

Time series of average number of steps per day for each five-minute interval

```{r Inverval_5,results='hide'}
library(dplyr)
data2 <- group_by(data1,interval) %>% summarise(average= mean(steps,na.rm = T))
with(data2,plot(interval,average,type = "l",col="blue",lwd="3",xlab = "Interval of 5 minutes",ylab = "Average per day"))
abline(v=max(data2[data2$average==max(data2$average),1]),col="red",lwd=1)
```

The five-minute interval with the highest average number of steps each day is `r data2[data2$average==max(data2$average),1]`

## Imputing missing values

1.Calculation of NA values

```{r NA}
colSums(is.na(data1))
```
The variable steps contains `r colSums(is.na(data1))[[1]]` NA values

2.We create a new data set by filling in the NA data with the mean of that five-minute interval.

```{r New_dataset}
data3 <- merge(data1,data2)
data3$steps <- ifelse(is.na(data3$steps),data3$average,data3$steps)
data3$average<- NULL
colSums(is.na(data3))
```

3.We generate a histogram with the new data set of the total number of raisins given each day, and we calculate their mean and median.

```{r Histogram2}
T_step2 <- sapply(split(data3,data1$date),function(x){sum(x$steps,na.rm = T)})
hist(T_step2,xlab = "Total Steps with NA",main = "New Histogram of Steps",col="blue")
abline(v=median(T_step2),col="red",lwd=4)
abline(v=mean(T_step2),col="green",lwd=4)
```

The median of the total steps per day in red is `r round(median(T_step2),2)`, and the mean of the total steps per day in green is `r round(mean(T_step2),2)`.

As seen in the following data, the means and medians of the data set with missing values differ with the completed values

```{r}
data.frame(data1=c(median(T_step),mean(T_step)),data3=c(median(T_step2),mean(T_step2)),diference=c(median(T_step2)-median(T_step),mean(T_step2)-mean(T_step)),row.names = c("median","mean"))
```
The impact generated by completing the missing data with the mean of each interval is that the median `r ifelse(median(T_step2)>median(T_step),"increased","decreased")` by `r median(T_step2)-median(T_step)` and the mean `r ifelse(mean(T_step2)>mean(T_step),"increased","decreased")` by `r mean(T_step2)-mean(T_step)`.

## Are there differences in activity patterns between weekdays and weekends?

We use the data set with missing values, we add a variable with the levels "weekday" and "weekend".

```{r}
data4 <- mutate(data1,typeday=as.Date(date))
data4$typeday <- as.factor(ifelse(weekdays(data4$typeday) %in% c("sábado","domingo"),"weekend","weekday"))
head(data4)
```
We generate a panel chart that contains time series charts by activity on weekends and weekdays.

```{r}
data4 <- group_by(data4,interval,typeday) %>% summarise(average= mean(steps,na.rm = T))
ggplot(data4,aes(interval,average)) + geom_line(colour="blue") + facet_grid(.~typeday) + ylab("Steps") + labs(title = "Type-day")
```
